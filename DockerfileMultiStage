# build artifact with maven
FROM maven:3-jdk-8-alpine AS BUILD_IMAGE
ADD . /my-app
WORKDIR /my-app
RUN mvn compile
RUN mvn package

# copy into the contanier and run it
FROM openjdk:8-jdk-alpine
ARG artifact
COPY --from=BUILD_IMAGE /my-app/target/${artifact}.jar ${artifact}.jar
RUN ls && pwd
ENV ART=${artifact}.jar
RUN echo ${ART}
RUN java -jar my-app-1.0.1.jar
RUN java -cp my-app-1.0.1.jar com.mycompany.app.App
CMD java -cp ${ART} com.mycompany.app.App
